<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Traffic Labb - Under Construction</title>
    <link rel="stylesheet" href="/style.css">
    <script src="/common.js"></script>
</head>
<body>
    <div id="loading" class="loading">
        <h2>Verifying access...</h2>
    </div>

    <div id="app" class="container hidden">
        <div class="dashboard-header">
            <div class="header-left">
                <div class="header-title">
                    <h1>Traffic Labb</h1>
                </div>
            </div>
        </div>

        <div class="main-content">
            <div class="glass-card">
                <div style="text-align: center; padding: 60px 40px;">
                    <div style="font-size: 4rem; margin-bottom: 20px;">üöß</div>
                    <h2 style="color: #354e8d; margin-bottom: 16px; font-size: 2.2rem;">Under Construction</h2>
                    <p style="color: #666; font-size: 1.1rem; margin-bottom: 30px; max-width: 500px; margin-left: auto; margin-right: auto; line-height: 1.6;">
                        We're working hard to bring you something amazing. This page will be available soon!
                    </p>
                    
                    <div style="background: #e3f1f7; padding: 20px; border-radius: 8px; margin: 30px auto; max-width: 400px; border: 1px solid #a3c9e0;">
                        <div style="font-size: 0.9rem; margin-bottom: 8px; font-weight: 600; color: #354e8d;">Expected Completion</div>
                        <div style="font-size: 1.3rem; color: #354e8d; font-weight: bold;">Coming Soon</div>
                        <div style="font-size: 0.8rem; color: #666; margin-top: 8px;">Check back later for updates</div>
                    </div>

                    <div style="margin-top: 40px;">
                        <button class="btn btn-run" onclick="window.history.back()" style="margin-right: 12px;">
                            ‚Üê Go Back
                        </button>
                        <button class="btn btn-reset" onclick="window.location.href='/'">
                            Home Page
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // Give common.js time to load manifest and handle authentication
            await new Promise(resolve => setTimeout(resolve, 100));
            
            // Check authentication using common.js functions
            const token = localStorage.getItem('authToken');
            if (!token || !isValidToken(token)) {
                window.location.href = '/login/';
                return;
            }
            
            // Show the app
            document.getElementById('loading').style.display = 'none';
            document.getElementById('app').classList.remove('hidden');
        });

        function isValidToken(token) {
            try {
                const decoded = atob(token);
                const [timestamp, username, accessLevel] = decoded.split(':');
                const tokenAge = Date.now() - parseInt(timestamp);
                
                // Use 24 hours as default, or get from manifest if available
                let expiryHours = 24;
                if (window.SITE_MANIFEST?.settings?.tokenExpiry) {
                    expiryHours = window.SITE_MANIFEST.settings.tokenExpiry;
                }
                
                return tokenAge < expiryHours * 60 * 60 * 1000;
            } catch {
                return false;
            }
        }
    </script>
</body>
</html>